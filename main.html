<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>FCL Explantory Visualization</title>

    <link rel="stylesheet" href="css/main.css"/>
    <link rel="stylesheet" href="css/slider.css"/>
    <link rel="stylesheet" href="css/zoomable_circles.css"/>
    <link rel="stylesheet" href="css/tooltip.css"/>
    <link rel="stylesheet" href="css/sliding_menuBar.css"/>
    <link rel="stylesheet" href="css/google_map.css"/>

    <script src="//d3js.org/d3.v3.min.js"></script>
    <script src="js/lib/topojson.v1.min.js"></script>

</head>

<body>

<script>

    var pop_layer = false;
    var co2_layer = false;
    var gdp_layer = false;

    var project_layer = false;
    var network_layer = false;
    var staff_layer = false;

    var map_width , map_height;
    map_width = screen.width;//document.getElementById("content_holder").offsetWidth;//
    map_height = screen.height;//window.innerHeight;//

    var point_layer_count = 0;

    function newInput(){

        //tooltip.style("visibility","hidden");
        //d3.selectAll(".navg_button").classed("selectedBtn",false);

        if(this.id){
            var holder = this.parentNode.id;
            var the_ul = d3.select("#"+holder).selectAll("ul");


            switch(this.id){
                case 'pop_densityBtn':

                             this.classList.toggle("selectedBtn");
                             the_ul.style("height","93px");
                             var res  = d3.select(this).classed("selectedBtn");


                        if(res){
                            SC.layer_count++;
                            SC.layer_stack[0]=SC.layer_count;
                            pop_layer = true;
                            the_ul.style("height","93px");
                            load_DData("pop_layer");
                        }else{
                            SC.layer_count--;
                            SC.layer_stack[0]=0;
                            pop_layer = false;
                            the_ul.style("height","0");
                            remove_layer('.pop_layer');
                            if(!(pop_layer|co2_layer|gdp_layer)){
                                redraw_worldmap();
                                //d3.select("#label_slider").remove();
                            }
                        }
                    break;
                case 'co2_emissionBtn':
                    this.classList.toggle("selectedBtn");
                    var res  = d3.select(this).classed("selectedBtn");

                    if(res){
                        SC.layer_count++;
                        SC.layer_stack[1]=SC.layer_count;
                        co2_layer = true;
                        the_ul.style("height","93px");
                        load_DData("co2_layer");
                    }else{
                        SC.layer_count--;
                        SC.layer_stack[1]=0;
                        co2_layer = false;
                        the_ul.style("height","0");
                        remove_layer('.co2_layer');
                        if(!(pop_layer|co2_layer|gdp_layer)){
                            redraw_worldmap();
                        }
                    }
                    break;

                case 'gdp_Btn':
                    this.classList.toggle("selectedBtn");
                    var res  = d3.select(this).classed("selectedBtn");

                    if(res){
                        SC.layer_count++;
                        SC.layer_stack[2]=SC.layer_count;
                        gdp_layer = true;
                        the_ul.style("height","93px");
                        load_DData("gdp_layer");
                    }else{
                        SC.layer_count--;
                        SC.layer_stack[2]=0;
                        gdp_layer = false;
                        the_ul.style("height","0");
                        remove_layer('.gdp_layer');
                        if(!(pop_layer|co2_layer|gdp_layer)){
                            redraw_worldmap();
                        }
                    }
                    break;

                case  'fcl_projectsBtn':

                    this.classList.toggle("selectedBtn");
                    var res  = d3.select(this).classed("selectedBtn");

                    if(res){
                        project_layer = true;
                       load_google_map();
                        load_DData("project_layer");
                        point_layer_count ++;
                    }else{
                        project_layer = false;
                        remove_layer('.project_layer');
                        point_layer_count--;
                    }
                    break;

                case 'global_networkBtn':

                    this.classList.toggle("selectedBtn");
                    var res  = d3.select(this).classed("selectedBtn");

                    if(res){
                        network_layer = true;
                        load_DData("network_layer");
                        point_layer_count++;
                    }else{
                        network_layer = false;
                        remove_layer('.network_layer');
                        point_layer_count--;
                    }
                    break;

                case 'academic_staffBtn':

                    this.classList.toggle("selectedBtn");
                    var res  = d3.select(this).classed("selectedBtn");

                    if(res){
                        staff_layer = true;
                        load_DData("staff_layer");
                        point_layer_count++;
                    }else{
                        staff_layer = false;
                        remove_layer('.staff_layer');
                        point_layer_count--;
                    }
                    break;


                default: break;
            }


            //d3.select(this).classed("selectedBtn",true);
        }else{
            d3.select("#pop_densityBtn").classed("selectedBtn",true);
        }

    }

    /* Set the width of the side navigation to 250px */
    var sideBar_open = false;
    function openNav() {
       // document.getElementById("fclSidenav").classList.toggle("show_side_bar");
        var sidebar = d3.select("#fclSidenav");
        if(sideBar_open){//clse the side_bar
            sideBar_open = false;
            d3.select("#fcl_projects").style("background-color","#FEFF8A").style("color","#000000");
            sidebar.attr("style","height:0px");
        }
        else{//open the side bar
            sideBar_open = true;
            d3.select("#fcl_projects").style("background-color","#1f2933").style("color","#ffffff");
            sidebar.attr("style","height:120px");

        }
    }



    var mydragg = function(){
        return {
            move : function(divid,xpos,ypos){
                document.getElementById(divid).style.right = xpos + 'px';
                document.getElementById(divid).style.top = ypos + 'px';
            },
            startMoving : function(divid,container,evt){
                evt = evt || window.event;
                var posX = evt.clientX,
                        posY = evt.clientY,
                        divTop = document.getElementById(divid).offsetTop,
                        divLeft = document.getElementById(divid).offsetLeft,
                        eWi = parseInt(document.getElementById(divid).offsetWidth),
                        eHe = parseInt(document.getElementById(divid).offsetHeight),
                        cWi = parseInt(document.getElementById(container).offsetWidth),
                        cHe = parseInt(document.getElementById(container).offsetHeight);
               // document.getElementById(container).style.cursor='move';
                //divTop = divTop.replace('px','');
                //divLeft = divLeft.replace('px','');
                var diffX = (divLeft+eWi) - posX,
                        diffY = posY - divTop;
                document.onmousemove = function(evt){
                    evt = evt || window.event;
                    var posX = evt.clientX,
                            posY = evt.clientY,
                            aX = cWi -(posX + diffX),  //right
                            aY = posY - diffY;
                    if (aX < 0) aX = 0;
                    if (aY < 0) aY = 0;
                    if (aX + eWi > cWi) aX = cWi - eWi;
                    if (aY + eHe > cHe) aY = cHe -eHe;
                    mydragg.move(divid,aX,aY);
                }

            },
            stopMoving : function(container){
                var a = document.createElement('script');
                document.getElementById(container).style.cursor='default';
                document.onmousemove = function(){}
            },
        }
    }();


    /*javascript for the modal*/
    // When the user clicks on the button, open the modal
    function modal_open() {
        var modal = document.getElementById('myModal');
        modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    function close_modal() {
        var modal = document.getElementById('myModal');
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        var modal = document.getElementById('myModal');
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

</script>

<div id="welcome_mask">
    <div class="welcome_msg">
        <p style="background-color: yellow;width:400px;"><img src='img/project_img/0_fcl_vis.jpg'></p>
    </div>
</div>

<div id="content_holder" style="height:"+map_height+"px;"width:"+map_width+"px;">

    <nav id = "menu_bar" class="no_userselect" >
        <div class ="holder">
        <div class="menu-item" style="padding: 10px; border-top: 0" onmousedown='mydragg.startMoving("menu_bar","content_holder",event);' onmouseup='mydragg.stopMoving("content_holder");'>
            <img id="fcl_logo" src="img/Logo_FCLwhite.png" alt="fcl_logo" width="180px" height="60px">
        </div>
        <hr>
        <div class="menu-item navg_button" id="pop_densityHolder">
            <h4 id ="pop_densityBtn"><a>  Population Density</a></h4>
            <ul>
                <li></li>
            </ul>
        </div>
        <hr><hr>
        <div class="menu-item navg_button" id="co2_emissionHolder">
            <h4 id = "co2_emissionBtn"><a>  CO2 Emission Per Capita</a></h4>
            <ul>
                <li></li>
            </ul>
        </div>
            <hr><hr>
            <div class="menu-item navg_button" id="gdpHolder">
                <h4 id = "gdp_Btn"><a>  GDP Per Capita</a></h4>
                <ul>
                    <li></li>
                </ul>
            </div>
        <hr><hr>
        <div class="menu-item" id="label_slider">
        </div>
        <hr><hr>
            </div>
        <div class="line_break"></div>
        <div id="fclHolder">
            <div style="background-color: #FEFF8A;    -webkit-box-shadow: 2px 2px 5px rgba(0,0,0,0.2);-moz-box-shadow: 2px 2px 5px rgba(0,0,0,0.2);">
                <button id="fcl_modal" onclick="modal_open()">FCL Rationale</button> | <button id="fcl_projects" onclick="openNav()">FCL Projects</button>
            </div>
            <!-- side bar-->
                    <div id="fclSidenav" class="no_userselect">
                      <img src="img/yellow.png" ><a href="#" id="fcl_projectsBtn">FCL Projects</a>
                        <img src="img/blue.png"><a href="#" id="global_networkBtn">Global Network</a>
                        <img src="img/pink.png" ><a href="#" id="academic_staffBtn">Academic Staff</a>
                            <a href="http://www.fcl.ethz.ch/" target="_blank" style="text-decoration:underline;color:dodgerblue;">FCL Website</a>
                    </div>
        </div>


    </nav>

    <!--the modal-->
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="close_modal()">×</span>
                <h2>FCL Rationale</h2>
            </div>
            <div class="modal-body">
                <p>Some text in the Modal Body</p>
                <p>Some other text...</p>
            </div>
            <div class="modal-footer">
                <h3>Footer</h3>
            </div>
        </div>
    </div>



    <div id="map_container">
        <!--<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3988.7830112895026!2d103.78620331459703!3d1.3052853620809883!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31da1a431841d5f1%3A0x160f705c61acdff3!2ssixty40!5e0!3m2!1sen!2ssg!4v1466989919758" width="600" height="450" frameborder="0" style="border:0" allowfullscreen></iframe>-->
    </div>

</div>


<script>
document.getElementById("content_holder").style.height=  window.innerHeight+'px';
document.getElementById('pop_densityBtn').addEventListener("click", newInput);
document.getElementById('co2_emissionBtn').addEventListener("click", newInput);
document.getElementById('gdp_Btn').addEventListener("click", newInput);
document.getElementById('fcl_projectsBtn').addEventListener("click", newInput);
document.getElementById('global_networkBtn').addEventListener("click", newInput);
document.getElementById('academic_staffBtn').addEventListener("click", newInput);
</script>

<script src="js/map/world_map.js"></script>
<script src="js/map/population_density_display.js"></script>
<script src="js/slider/timer_slider.js"></script>
<script src="js/slider/color_slider.js"></script>
<script src="js/map/zoomable_circles.js"></script>
<script src="js/google_map/google_map.js"></script>

</body>
</html>